<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Happy Birthday My Love</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display",
          "Segoe UI", system-ui, sans-serif;
        background: linear-gradient(
          135deg,
          #ffeef8 0%,
          #ffe5f1 25%,
          #fff0f8 50%,
          #ffe8f3 75%,
          #fff5fa 100%
        );
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        position: relative;
        overflow: auto;
      }

      body::before {
        content: "";
        position: absolute;
        width: 500px;
        height: 500px;
        background: radial-gradient(
          circle,
          rgba(255, 182, 193, 0.15) 0%,
          transparent 70%
        );
        border-radius: 50%;
        top: -100px;
        right: -100px;
        animation: float 20s ease-in-out infinite;
      }

      body::after {
        content: "";
        position: absolute;
        width: 400px;
        height: 400px;
        background: radial-gradient(
          circle,
          rgba(255, 105, 180, 0.12) 0%,
          transparent 70%
        );
        border-radius: 50%;
        bottom: -80px;
        left: -80px;
        animation: float 25s ease-in-out infinite reverse;
      }

      @keyframes gradientShift {
        0%,
        100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 40px;
        padding: 60px 50px;
        max-width: 1200px;
        width: 100%;
        box-shadow: 0 25px 80px rgba(255, 105, 180, 0.25),
          0 10px 40px rgba(255, 182, 193, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.8);
        text-align: center;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 192, 203, 0.3);
      }

      .container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 192, 203, 0.5),
          transparent
        );
      }

      /* --- Animations --- */
      .fade-in {
        animation: fadeIn 0.7s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }
      .fade-out {
        animation: fadeOut 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }
      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      .cat-gif {
        width: 140px;
        height: 140px;
        margin: 0 auto 25px;
        animation: float 3.5s ease-in-out infinite;
        border-radius: 50%;
        box-shadow: 0 15px 40px rgba(255, 105, 180, 0.3);
        border: 4px solid rgba(255, 192, 203, 0.4);
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0) scale(1);
        }
        50% {
          transform: translateY(-12px) scale(1.02);
        }
      }

      h1 {
        background: linear-gradient(
          135deg,
          #ff1493 0%,
          #ff69b4 50%,
          #ffb6c1 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 48px;
        font-weight: 700;
        margin-bottom: 18px;
        letter-spacing: -0.5px;
        animation: popIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        text-shadow: 0 2px 20px rgba(255, 105, 180, 0.15);
      }

      @keyframes popIn {
        0% {
          transform: scale(0.85);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .subtitle {
        color: #ff69b4;
        font-size: 19px;
        margin-bottom: 35px;
        font-style: italic;
        font-weight: 500;
        animation: fadeIn 1.2s ease;
        letter-spacing: 0.3px;
      }
      .typewriter {
        display: inline-block;
        min-height: 1.2em;
        padding-right: 10px;
        white-space: nowrap;
        overflow: hidden;
        animation: caretBlink 0.85s step-end infinite;
        width: fit-content;
        height: fit-content;
        text-wrap: auto;
      }

      .letter-message {
        display: block;
        animation: caretBlink 0.85s step-end infinite;
        white-space: pre-line;
        min-height: 1.9em;
        padding-right: 6px;
        margin-bottom: 12px;
        color: #555;
        line-height: 1.9;
        font-size: 16px;
      }

      .letter-message.finished {
        border-right: none;
        animation: none;
      }
      @keyframes caretBlink {
        from {
          border-color: rgba(255, 105, 180, 0.85);
        }
        to {
          border-color: transparent;
        }
      }
      .button-group {
        display: flex;
        gap: 18px;
        justify-content: center;
        flex-wrap: wrap;
      }

      button {
        background: linear-gradient(135deg, #ff1493 0%, #ff69b4 100%);
        color: white;
        border: none;
        padding: 18px 45px;
        border-radius: 30px;
        font-size: 17px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 8px 25px rgba(255, 20, 147, 0.35),
          0 2px 8px rgba(255, 105, 180, 0.2);
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
      }

      button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.5s;
      }

      button:hover::before {
        left: 100%;
      }

      button:hover {
        transform: translateY(-4px) scale(1.03);
        box-shadow: 0 12px 35px rgba(255, 20, 147, 0.45),
          0 4px 15px rgba(255, 105, 180, 0.3);
      }

      button:active {
        transform: translateY(-2px) scale(0.98);
      }

      button.no-btn {
        background: linear-gradient(135deg, #ffe0e9 0%, #ffc0cb 100%);
        color: #c91f6e;
        font-weight: 700;
        box-shadow: 0 8px 25px rgba(255, 192, 203, 0.3);
      }

      .choices-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 25px;
        margin-top: 35px;
        animation: fadeIn 0.8s ease;
      }

      .choice-card {
        background: linear-gradient(
          135deg,
          rgba(255, 240, 248, 0.9) 0%,
          rgba(255, 224, 233, 0.9) 100%
        );
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 105, 180, 0.25);
        border-radius: 28px;
        padding: 35px 25px;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
      }

      .choice-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(255, 105, 180, 0.1) 0%,
          transparent 100%
        );
        opacity: 0;
        transition: opacity 0.4s;
      }

      .choice-card:hover::before {
        opacity: 1;
      }

      .choice-card:hover {
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 20px 50px rgba(255, 105, 180, 0.35);
        border-color: rgba(255, 105, 180, 0.5);
      }

      .choice-card .icon {
        font-size: 50px;
        margin-bottom: 12px;
        animation: float 3s ease-in-out infinite;
      }

      .choice-card .label {
        color: #c91f6e;
        font-size: 15px;
        font-weight: 700;
        letter-spacing: 0.5px;
        text-transform: uppercase;
      }

      .content-box {
        background: linear-gradient(
          135deg,
          rgba(255, 245, 247, 0.95) 0%,
          rgba(255, 240, 248, 0.95) 100%
        );
        backdrop-filter: blur(15px);
        border: 2px solid rgba(255, 105, 180, 0.25);
        border-radius: 30px;
        padding: 40px;
        margin-top: 35px;
        text-align: left;
        animation: fadeIn 0.8s ease;
        box-shadow: 0 15px 40px rgba(255, 105, 180, 0.15);
      }

      .content-box h2 {
        background: linear-gradient(135deg, #ff1493 0%, #ff69b4 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 25px;
        text-align: center;
        font-size: 32px;
        font-weight: 700;
        letter-spacing: -0.5px;
      }

      .content-box p {
        color: #555;
        line-height: 1.9;
        margin-bottom: 18px;
        font-size: 16px;
        letter-spacing: 0.2px;
      }

      .back-btn {
        margin-top: 25px;
        background: linear-gradient(135deg, #ffb6c1 0%, #ff69b4 100%);
        padding: 14px 40px;
        font-size: 16px;
        animation: fadeIn 0.8s ease;
      }

      .icon {
        width: 120px;
        height: 120px;
        display: flex;
        justify-content: center;
        align-items: center;
        filter: drop-shadow(0 5px 15px rgba(255, 105, 180, 0.2));
      }

      .icon img {
        width: 85%;
        height: 85%;
        border-radius: 18px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .icon img:hover {
        transform: scale(1.15) rotate(3deg);
        filter: brightness(1.1);
      }

      .label {
        color: #c91f6e;
        font-size: 15px;
        font-weight: 700;
        letter-spacing: 0.5px;
      }

      .icon img.sticker {
        width: 100%;
        height: auto;
        max-width: 300px;
        max-height: 300px;
        display: block;
        margin: 0 auto;
        animation: buildIn 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }

      @keyframes buildIn {
        0% {
          opacity: 0;
          transform: scale(0.75) rotate(-15deg);
        }
        60% {
          opacity: 1;
          transform: scale(1.1) rotate(8deg);
        }
        100% {
          opacity: 1;
          transform: scale(1) rotate(0);
        }
      }

      .polaroid-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 28px;
        margin-top: 25px;
        justify-items: center;
        height: 370px;
        overflow: auto;
      }

      .polaroid {
        background: #fff;
        padding: 14px;
        border-radius: 16px;
        box-shadow: 0 10px 35px rgba(0, 0, 0, 0.15),
          0 3px 10px rgba(255, 105, 180, 0.1);
        width: 480px;
        aspect-ratio: 4/3;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: floaty 4.5s ease-in-out infinite;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(255, 192, 203, 0.2);
      }

      .polaroid:hover {
        transform: translateY(-10px) rotate(2deg) scale(1.05);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2),
          0 5px 20px rgba(255, 105, 180, 0.2);
      }

      .polaroid-img {
        width: 100%;
        height: 100%;
        border-radius: 10px;
        overflow: hidden;
      }

      .polaroid-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 10px;
        display: block;
        transition: transform 0.4s ease;
      }

      .polaroid:hover .polaroid-img img {
        transform: scale(1.08);
      }

      @keyframes floaty {
        0% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-15px);
        }
        100% {
          transform: translateY(0px);
        }
      }

      .music-player {
        background: linear-gradient(135deg, #1f1f2e 0%, #252538 100%);
        border-radius: 30px;
        padding: 40px;
        margin-top: 25px;
        color: white;
        animation: fadeIn 0.9s ease;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 192, 203, 0.15);
      }

      .music-player h2 {
        color: #fff !important;
        background: none !important;
        -webkit-text-fill-color: white !important;
        text-shadow: 0 2px 15px rgba(255, 105, 180, 0.3);
      }

      .vinyl {
        width: 220px;
        height: 220px;
        background: radial-gradient(
          circle,
          #f0f0f0 0%,
          #6a6a6a 45%,
          #2a2a2a 100%
        );
        border-radius: 50%;
        margin: 25px auto;
        position: relative;
        animation: spin 4s linear infinite;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5),
          inset 0 0 30px rgba(0, 0, 0, 0.3);
      }

      .vinyl::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, #ff1493 0%, #ff69b4 100%);
        border-radius: 50%;
        box-shadow: 0 0 30px rgba(255, 105, 180, 0.8),
          inset 0 0 20px rgba(255, 255, 255, 0.2);
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .song-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 22px;
        margin-top: 30px;
      }

      .song-card {
        background: linear-gradient(
          160deg,
          rgba(255, 240, 248, 0.9) 0%,
          rgba(255, 228, 240, 0.95) 50%,
          rgba(255, 214, 235, 0.9) 100%
        );
        border-radius: 20px;
        padding: 20px 18px;
        box-shadow: 0 15px 30px rgba(255, 105, 180, 0.15);
        border: 1px solid rgba(255, 192, 203, 0.4);
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        justify-content: space-between;
      }

      .song-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 20px 35px rgba(255, 105, 180, 0.25);
      }

      .song-cover {
        width: 70%;
        aspect-ratio: 1 / 1;
        border-radius: 16px;
        background: linear-gradient(140deg, #ff69b4, #ff1493);
        display: grid;
        place-items: center;
        color: rgba(255, 255, 255, 0.9);
        font-size: 32px;
        font-weight: 700;
        letter-spacing: 1px;
        box-shadow: inset 0 0 25px rgba(255, 255, 255, 0.25);
      }
      .song-cover-1 {
        background-image: url(https://i.scdn.co/image/ab67616d00001e028c9b415ea3933ba5664e0382);
        background-size: contain;
      }
      .song-cover-2 {
        background-image: url(https://i.scdn.co/image/ab67616d00001e02c4a7e933ef7fbb7e6485b73a);
        background-size: contain;
      }
      .song-cover-3 {
        background-image: url(https://i.scdn.co/image/ab67616d00001e02d5a8395b0d80b8c48a5d851c);
        background-size: contain;
      }
      .song-cover-4 {
        background-image: url(https://i.scdn.co/image/ab67616d00001e026b18d0490878750cd69abf2c);
        background-size: contain;
      }
      .song-cover-5 {
        background-image: url(https://i.scdn.co/image/ab67616d00001e0221bed1edfd0800448c36461d);
        background-size: contain;
      }
      .song-cover-6 {
        background-image: url(https://i.scdn.co/image/ab67616d00001e02e321a69d7454d9365c667187);
        background-size: contain;
      }

      .song-title {
        font-size: 18px;
        font-weight: 700;
        color: #ff3e8a;
        margin-top: 18px;
        margin-bottom: 6px;
        letter-spacing: 0.2px;
      }

      .artist {
        font-size: 15px;
        color: #c91f6e;
        font-weight: 500;
        margin-bottom: 14px;
        letter-spacing: 0.3px;
      }

      .song-card audio {
        width: 100%;
        outline: none;
        border-radius: 12px;
      }
      .reasons-list {
        background: white;
        border-radius: 20px;
        padding: 30px;
        margin-top: 25px;
        box-shadow: 0 10px 30px rgba(255, 105, 180, 0.1);
      }

      .reason-item {
        background: linear-gradient(
          135deg,
          rgba(255, 240, 248, 0.8) 0%,
          rgba(255, 245, 247, 0.8) 100%
        );
        border-left: 5px solid #ff69b4;
        padding: 18px 20px;
        margin-bottom: 16px;
        border-radius: 12px;
        color: #555;
        animation: fadeIn 0.8s ease;
        font-size: 15px;
        line-height: 1.6;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(255, 105, 180, 0.08);
      }

      .reason-item:hover {
        transform: translateX(8px);
        box-shadow: 0 6px 20px rgba(255, 105, 180, 0.15);
        border-left-color: #ff1493;
      }

      .hidden {
        display: none;
      }

      @media (max-width: 640px) {
        .container {
          padding: 40px 30px;
          border-radius: 30px;
        }

        h1 {
          font-size: 36px;
        }

        .choices-grid {
          gap: 18px;
        }

        .choice-card {
          padding: 28px 20px;
        }

        .polaroid {
          width: 200px;
        }
        .song-grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="screen1" class="fade-in">
        <img src="CatLetter.gif" class="cat-gif" alt="cat with letter" />
        <h1>Hello My Love!</h1>
        <p class="subtitle">do you want to see your gift?</p>
        <div class="button-group">
          <button onclick="showScreen2()">YES PLEASE</button>
          <button class="no-btn" onclick="showPromise()">NO THANKS</button>
        </div>
      </div>

      <div id="screen-promise" class="hidden">
        <img src="CatSad.gif" class="cat-gif" alt="sad cat" />
        <h1>I promise you'll like it</h1>
        <button onclick="showScreen2()">TRY AGAIN</button>
      </div>

      <div id="screen2" class="hidden">
        <h1>THESE ARE FOR YOU!</h1>
        <p class="subtitle">I hope you like it, I love you</p>
        <div class="choices-grid">
          <div class="choice-card" onclick="showFlowers()">
            <div class="icon">
              <img src="Flowers.gif" alt="flowers" />
            </div>
            <div class="label">Flowers</div>
          </div>

          <div class="choice-card" onclick="showSong()">
            <div class="icon">
              <img src="Music.gif" alt="music" />
            </div>
            <div class="label">Song</div>
          </div>

          <div class="choice-card" onclick="showLetter()">
            <div class="icon">
              <img src="Letter.gif" alt="letter" />
            </div>
            <div class="label">Letter</div>
          </div>

          <div class="choice-card" onclick="showPhotos()">
            <div class="icon">
              <img src="Pictures.gif" alt="pictures" />
            </div>
            <div class="label">Photos</div>
          </div>
        </div>
      </div>

      <div id="screen-flowers" class="hidden">
        <div class="content-box">
          <h2>🌷 TULIPS 🌷</h2>
          <p
            style="
              text-align: center;
              font-style: italic;
              color: #c91f6e;
              font-size: 18px;
            "
          >
            your favorite flower
          </p>
          <div class="reasons-list">
            <div class="reason-item">
              You're as beautiful as tulips in spring
            </div>
            <div class="reason-item">
              Your smile brightens my day like flowers in bloom
            </div>
            <div class="reason-item">You bring color to my life</div>
            <div class="reason-item">
              Just like tulips, you're delicate yet strong
            </div>
            <div class="reason-item">You make my heart blossom</div>
            <div class="reason-item">
              Your love grows in my heart like a garden
            </div>
            <div class="reason-item">
              You're the most precious flower in my life
            </div>
            <div class="reason-item">
              Every moment with you is like a beautiful spring day
            </div>
          </div>
        </div>
        <button class="back-btn" onclick="showScreen2()">← Back</button>
      </div>

      <div id="screen-song" class="hidden">
        <div class="music-player">
          <h2
            id="song-message"
            class="typewriter"
            data-message="Whenever I Hear These, I Think of You Nigga"
          ></h2>
          <div class="song-grid">
            <div class="song-card">
              <div class="song-cover song-cover-1">01</div>
              <div class="song-title">Terrified</div>
              <div class="artist">Katharine McPhee • secret message: July</div>
              <audio controls src="audio/Terrified.mp3"></audio>
            </div>

            <div class="song-card">
              <div class="song-cover song-cover-2">02</div>
              <div class="song-title">Bubbly</div>
              <div class="artist">Colbie Caillat • secret message: July</div>
              <audio controls src="audio/Bubbly.mp3"></audio>
            </div>

            <div class="song-card">
              <div class="song-cover song-cover-3">03</div>
              <div class="song-title">Sure Thing</div>
              <div class="artist">Miguel • secret message: July</div>
              <audio controls src="audio/Sure_Thing.mp3"></audio>
            </div>

            <div class="song-card">
              <div class="song-cover song-cover-4">04</div>
              <div class="song-title">Adore You</div>
              <div class="artist">Harry Styles • secret message: July</div>
              <audio controls src="audio/Adore_You.mp3"></audio>
            </div>

            <div class="song-card">
              <div class="song-cover song-cover-5">05</div>
              <div class="song-title">When I Met You</div>
              <div class="artist">Nigga • secret message: July</div>
              <audio controls src="audio/When_I_Met_you.mp3"></audio>
            </div>

            <div class="song-card">
              <div class="song-cover song-cover-6">06</div>
              <div class="song-title">The Most Beautiful Thing</div>
              <div class="artist">Bruno Major • secret message: July</div>
              <audio controls src="audio/The_Most_Beautiful_Thin.mp3"></audio>
            </div>
          </div>
        </div>
        <button class="back-btn" onclick="showScreen2()">← Back</button>
      </div>

      <div id="screen-letter" class="hidden">
        <div class="content-box">
          <h2>💕 HAPPIEST BIRTHDAY, MY LOVE! 💕</h2>
          <p id="letter-message" class="letter-message"></p>
          <p
            style="
              text-align: right;
              font-style: italic;
              color: #c91f6e;
              margin-top: 20px;
            "
          >
            Sincerely,<br />The luckiest person alive 💕
          </p>
        </div>
        <button class="back-btn" onclick="showScreen2()">← Back</button>
      </div>

      <div id="screen-photos" class="hidden">
        <div class="content-box">
          <h2>📸 Little Moments, Big Memories 💕</h2>

          <div class="polaroid-grid">
            <div class="polaroid">
              <div class="polaroid-img">
                <img src="Zuzy1.PNG" alt="memory 1" />
              </div>
            </div>

            <div class="polaroid">
              <div class="polaroid-img">
                <img src="Zuzy2.PNG" alt="memory 2" />
              </div>
            </div>

            <div class="polaroid">
              <div class="polaroid-img">
                <img src="Zuzy3.PNG" alt="memory 3" />
              </div>
            </div>

            <div class="polaroid">
              <div class="polaroid-img">
                <img src="Zuzy4.PNG" alt="memory 4" />
              </div>
            </div>

            <div class="polaroid">
              <div class="polaroid-img">
                <img src="Zuzy5.JPG" alt="memory 5" />
              </div>
            </div>

            <div class="polaroid">
              <div class="polaroid-img">
                <img src="Zuzy6.PNG" alt="memory 6" />
              </div>
            </div>
          </div>
        </div>
        <button class="back-btn" onclick="showScreen2()">← Back</button>
      </div>
    </div>
    <audio
      id="letter-hover-audio"
      src="audio/LetterSong.mp3"
      preload="auto"
      aria-hidden="true"
    ></audio>
    <script>
      const letterHoverAudio = document.getElementById("letter-hover-audio");
      let letterAudioFadeInterval = null;
      let letterMessageData = null;
      let letterMessagePromise =
        typeof fetch === "function"
          ? fetch("letter-message.json")
              .then((response) => {
                if (!response.ok) {
                  throw new Error("Failed to load letter message");
                }
                return response.json();
              })
              .then((data) => {
                const message =
                  data && typeof data.birthdayLetter === "string"
                    ? data.birthdayLetter
                    : "";
                letterMessageData = { message };
                return letterMessageData;
              })
              .catch(() => {
                letterMessageData = { message: "" };
                return letterMessageData;
              })
          : null;

      function stopLetterAudio() {
        if (!letterHoverAudio) return;
        if (letterAudioFadeInterval) {
          clearInterval(letterAudioFadeInterval);
          letterAudioFadeInterval = null;
        }
        letterHoverAudio.pause();
        letterHoverAudio.currentTime = 0;
        letterHoverAudio.volume = 0;
      }
      function fadeInLetterAudio(audio, duration = 2000) {
        if (!audio) return;
        if (letterAudioFadeInterval) {
          clearInterval(letterAudioFadeInterval);
          letterAudioFadeInterval = null;
        }
        const fadeDuration = Math.max(duration, 0);
        const steps = 20;
        const stepTime = steps > 0 ? fadeDuration / steps : fadeDuration;
        const volumeStep = steps > 0 ? 1 / steps : 1;

        audio.currentTime = 0;
        audio.volume = 0;
        const playPromise = audio.play();
        if (playPromise && typeof playPromise.then === "function") {
          playPromise.catch(() => {});
        }

        if (!stepTime) {
          audio.volume = 1;
          return;
        }

        letterAudioFadeInterval = setInterval(() => {
          const nextVolume = Math.min(1, audio.volume + volumeStep);
          audio.volume = nextVolume;
          if (nextVolume >= 1) {
            clearInterval(letterAudioFadeInterval);
            letterAudioFadeInterval = null;
            audio.volume = 1;
          }
        }, stepTime);
      }
      function hideAll() {
        stopLetterAudio();
        document.querySelectorAll(".container > div").forEach((el) => {
          el.classList.add("hidden");
          el.classList.remove("fade-in");
        });
      }

      function showScreen(id) {
        hideAll();
        const screen = document.getElementById(id);
        screen.classList.remove("hidden");
        screen.classList.add("fade-in");
      }

      function showScreen2() {
        showScreen("screen2");
      }
      function showPromise() {
        showScreen("screen-promise");
      }
      function showFlowers() {
        showScreen("screen-flowers");
      }
      function showSong() {
        showScreen("screen-song");
        typeSongMessage();
      }
      function showLetter() {
        showScreen("screen-letter");
        typeLetterMessage();
        if (letterHoverAudio) {
          fadeInLetterAudio(letterHoverAudio, 5000);
        }
      }
      function showPhotos() {
        showScreen("screen-photos");
      }

      const typeSongMessage = (() => {
        let typingTimer;
        return () => {
          const messageEl = document.getElementById("song-message");
          if (!messageEl) return;
          const message = messageEl.dataset.message || "";

          if (typingTimer) {
            clearTimeout(typingTimer);
          }

          messageEl.textContent = "";
          messageEl.classList.remove("finished");

          let index = 0;
          const typeNext = () => {
            if (index <= message.length) {
              messageEl.textContent = message.slice(0, index);
              index += 1;
              typingTimer = setTimeout(typeNext, 70);
            } else {
              messageEl.classList.add("finished");
            }
          };

          typeNext();
        };
      })();
      const typeLetterMessage = (() => {
        let typingTimer;
        const startTyping = (letterMessage, text) => {
          const safeText = text || "";
          letterMessage.dataset.text = safeText;
          letterMessage.textContent = "";
          letterMessage.classList.remove("finished");

          let charIndex = 0;
          const typeNext = () => {
            if (charIndex <= safeText.length) {
              letterMessage.textContent = safeText.slice(0, charIndex);
              charIndex += 1;
              typingTimer = setTimeout(typeNext, 45);
            } else {
              letterMessage.textContent = safeText;
              letterMessage.classList.add("finished");
            }
          };

          typeNext();
        };

        return () => {
          const letterMessage = document.getElementById("letter-message");
          if (!letterMessage) return;

          if (typingTimer) {
            clearTimeout(typingTimer);
          }

          const existingText =
            (letterMessageData && typeof letterMessageData.message === "string"
              ? letterMessageData.message
              : "") ||
            letterMessage.dataset.text ||
            letterMessage.textContent ||
            "";

          if (existingText) {
            if (
              !letterMessageData ||
              typeof letterMessageData.message !== "string"
            ) {
              letterMessageData = { message: existingText };
            }
            startTyping(letterMessage, existingText);
            return;
          }

          if (!letterMessagePromise) {
            startTyping(letterMessage, "");
            return;
          }

          letterMessagePromise
            .then((data) => {
              const resolved =
                data && typeof data.message === "string" ? data.message : "";
              startTyping(letterMessage, resolved);
            })
            .catch(() => {
              startTyping(letterMessage, "");
            });
        };
      })();

    </script>
  </body>
</html>
